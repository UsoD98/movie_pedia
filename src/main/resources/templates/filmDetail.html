<!DOCTYPE html>
<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout.html}">
<head>
    <meta charset="UTF-8">
    <title>Film Detail</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .film-poster {
            max-width: 300px;
            height: auto;
            display: block;
            margin: 0 auto 20px;
        }

        .film-backdrop {
            width: 100%;
            height: auto;
            margin-bottom: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
        }

        .film-info {
            margin-bottom: 10px;
        }

        .film-info strong {
            color: #555;
        }

        .film-overview {
            margin-top: 20px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .star-rating {
            font-size: 0;
            white-space: nowrap;
            display: inline-block;
            width: 250px;
            height: 50px;
            overflow: hidden;
            position: relative;
            background: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMjBweCIgaGVpZ2h0PSIyMHB4IiB2aWV3Qm94PSIwIDAgMjAgMjAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIwIDIwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cG9seWdvbiBmaWxsPSIjREREREREIiBwb2ludHM9IjEwLDAgMTMuMDksNi41ODMgMjAsNy42MzkgMTUsMTIuNzY0IDE2LjE4LDIwIDEwLDE2LjU4MyAzLjgyLDIwIDUsMTIuNzY0IDAsNy42MzkgNi45MSw2LjU4MyAiLz48L3N2Zz4=');
            background-size: 50px 50px;
        }
        .star-rating label {
            opacity: 0;
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            z-index: 1;
            background: url('data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB3aWR0aD0iMjBweCIgaGVpZ2h0PSIyMHB4IiB2aWV3Qm94PSIwIDAgMjAgMjAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDIwIDIwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cG9seWdvbiBmaWxsPSIjRkZERjg4IiBwb2ludHM9IjEwLDAgMTMuMDksNi41ODMgMjAsNy42MzkgMTUsMTIuNzY0IDE2LjE4LDIwIDEwLDE2LjU4MyAzLjgyLDIwIDUsMTIuNzY0IDAsNy42MzkgNi45MSw2LjU4MyAiLz48L3N2Zz4=');
            background-size: 50px 50px;
        }
        .star-rating input {
            -moz-appearance: none;
            -webkit-appearance: none;
            opacity: 0;
            display: inline-block;
            width: 10%;
            height: 100%;
            margin: 0;
            padding: 0;
            z-index: 2;
            position: relative;
            cursor: pointer;
        }
        .star-rating input:hover + label,
        .star-rating input:checked + label {
            opacity: 1;
        }
        .star-rating input:nth-of-type(1) + label {
            width: 10%;
        }
        .star-rating input:nth-of-type(2) + label {
            width: 20%;
        }
        .star-rating input:nth-of-type(3) + label {
            width: 30%;
        }
        .star-rating input:nth-of-type(4) + label {
            width: 40%;
        }
        .star-rating input:nth-of-type(5) + label {
            width: 50%;
        }
        .star-rating input:nth-of-type(6) + label {
            width: 60%;
        }
        .star-rating input:nth-of-type(7) + label {
            width: 70%;
        }
        .star-rating input:nth-of-type(8) + label {
            width: 80%;
        }
        .star-rating input:nth-of-type(9) + label {
            width: 90%;
        }
        .star-rating input:nth-of-type(10) + label {
            width: 100%;
        }

        /*//////////////////////////////////버튼 꾸미기*/
.action-buttons {
    display: flex; /* Flexbox로 버튼을 수평 배치 */
    gap: 15px; /* 버튼 사이의 간격 */
    justify-content: center; /* 버튼을 중앙에 배치 */
    margin-top: 20px; /* 버튼과 다른 요소 사이의 여백 */
}

.action-buttons form {
    margin: 0; /* 폼의 기본 여백 제거 */
}

button {
    background-color: #ffffff; /* 기본 배경색: 흰색 */
    color: #333333; /* 기본 텍스트 색상: 짙은 회색 */
    border: 2px solid #cccccc; /* 버튼 테두리 색상 */
    padding: 12px 25px; /* 버튼의 패딩 */
    cursor: pointer; /* 커서가 버튼 위에 있을 때 손 모양으로 변경 */
    font-size: 16px; /* 버튼의 폰트 크기 */
    border-radius: 8px; /* 버튼의 둥근 모서리 */
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; /* 색상 및 테두리 색상 변경에 대한 부드러운 전환 효과 */
    font-weight: bold; /* 버튼 텍스트 두껍게 */
}

button:hover {
    background-color: #f1f1f1; /* 버튼 호버 시 배경색 */
}

button:active {
    background-color: #e0e0e0; /* 버튼 클릭 시 배경색 */
}

.checked-button {
    background-color: #007bff; /* 선택된 버튼의 배경색: 파란색 */
    color: #ffffff; /* 선택된 버튼의 텍스트 색상: 흰색 */
    border-color: #007bff; /* 선택된 버튼의 테두리 색상 */
}

.checked-button:hover {
    background-color: #0056b3; /* 선택된 버튼 호버 시 배경색 */
}

.checked-button:active {
    background-color: #00408d; /* 선택된 버튼 클릭 시 배경색 */
}
    </style>
</head>
<body>
<section layout:fragment="content">
    <div class="container" th:if="${film}">
        <h1 th:text="${film.title}">영화 제목</h1>
        <!-- 평균 평점 -->
        <div class="film-info">
            <strong>평균 평점:</strong> <span th:text="${film.averageRating}">평균 평점</span>
        </div>
        <!-- 총 평가 수 -->
        <div class="film-info">
            <strong>총 평가 수:</strong> <span th:text="${film.ratingCount}">총 평가 수</span>
        </div>
        <!-- 별점 기능 추가 -->
        <div class="rating-section">
            <h3>평점 주기</h3>
            <form id="ratingForm" th:action="@{/films/{filmId}/rating(filmId=${film.id})}" method="post">
                <div class="star-rating">
                    <input type="radio" id="star0.5" name="score" value="0.5" th:checked="${film.userScore != null && film.userScore == 0.5}" />
                    <label for="star0.5" title="0.5점"></label>
                    <input type="radio" id="star1" name="score" value="1" th:checked="${film.userScore != null && film.userScore == 1}" />
                    <label for="star1" title="1점"></label>
                    <input type="radio" id="star1.5" name="score" value="1.5" th:checked="${film.userScore != null && film.userScore == 1.5}" />
                    <label for="star1.5" title="1.5점"></label>
                    <input type="radio" id="star2" name="score" value="2" th:checked="${film.userScore != null && film.userScore == 2}" />
                    <label for="star2" title="2점"></label>
                    <input type="radio" id="star2.5" name="score" value="2.5" th:checked="${film.userScore != null && film.userScore == 2.5}" />
                    <label for="star2.5" title="2.5점"></label>
                    <input type="radio" id="star3" name="score" value="3" th:checked="${film.userScore != null && film.userScore == 3}" />
                    <label for="star3" title="3점"></label>
                    <input type="radio" id="star3.5" name="score" value="3.5" th:checked="${film.userScore != null && film.userScore == 3.5}" />
                    <label for="star3.5" title="3.5점"></label>
                    <input type="radio" id="star4" name="score" value="4" th:checked="${film.userScore != null && film.userScore == 4}" />
                    <label for="star4" title="4점"></label>
                    <input type="radio" id="star4.5" name="score" value="4.5" th:checked="${film.userScore != null && film.userScore == 4.5}" />
                    <label for="star4.5" title="4.5점"></label>
                    <input type="radio" id="star5" name="score" value="5" th:checked="${film.userScore != null && film.userScore == 5}" />
                    <label for="star5" title="5점"></label>
                </div>
            </form>
        </div>

        <!-- 코멘트 버튼 -->
        <div class="film-info">
            <a th:href="@{/films/{filmId}/comments(filmId=${film.id})}" class="btn btn-primary">코멘트</a>        </div>

        <img th:if="${film.backdropPath}"
             th:src="@{'https://image.tmdb.org/t/p/w500' + ${film.backdropPath}}"
             class="film-backdrop" alt="영화 배경">

        <img th:if="${film.posterPath}"
             th:src="@{'https://image.tmdb.org/t/p/w500' + ${film.posterPath}}"
             class="film-poster" alt="영화 포스터">

        <div class="film-info">
            <strong>영화 코드:</strong> <span th:text="${film.movieCd}">영화 코드</span>
        </div>

        <div class="film-info">
            <strong>TMDB ID:</strong> <span th:text="${film.movieId}">TMDB ID</span>
        </div>

        <div class="film-info">
            <strong>개봉일:</strong> <span th:text="${#temporals.format(film.releaseDate, 'yyyy-MM-dd')}">개봉일</span>
        </div>

        <div class="film-info">
            <strong>원제:</strong> <span th:text="${film.originalTitle}">원제</span>
        </div>

        <div class="film-info" th:if="${film.originCountry}">
            <strong>국가:</strong> <span th:text="${film.originCountry}">국가</span>
        </div>
        <!-- 보고싶어요와 보고있어요 버튼 추가 -->
        <div class="action-buttons">
            <!-- "보고싶어요" 버튼 -->
            <form th:action="@{/films/{filmId}/wish_watching(filmId=${film.id})}" method="post">
                <input type="hidden" name="action" value="wish" />
                <button type="submit" th:classappend="${film.wishWatchingResponse != null and film.wishWatchingResponse.wish} ? 'checked-button' : ''">Wish</button>
            </form>

            <!-- "보고있어요" 버튼 -->
            <form th:action="@{/films/{filmId}/wish_watching(filmId=${film.id})}" method="post">
                <input type="hidden" name="action" value="watching" />
                <button type="submit" th:classappend="${film.wishWatchingResponse != null and film.wishWatchingResponse.watching} ? 'checked-button' : ''">Watching</button>
            </form>
        </div>

        <div class="film-overview">
            <strong>줄거리:</strong>
            <p th:text="${film.overview}">영화 줄거리</p>
        </div>

        <!-- 코멘트 출력 -->
        <div th:if="${comments}" style="margin-top: 20px;">
            <h2>코멘트</h2>
            <div>
                <div th:each="comment : ${comments}">
                    <div>
                        <strong th:text="${comment.username}">사용자 이름</strong>
                        <span th:text="${comment.content}">코멘트 내용</span>
                        <!-- 평점 -->
                        <span th:if="${comment.ratingScore}">★: <span th:text="${comment.ratingScore}">평점</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 영화 관련 이미지들 출력 -->
        <div th:if="${film_img}" style="margin-top: 20px;">
            <h2>관련 이미지</h2>
            <div>
                <div th:each="img : ${film_img}">
                    <img th:src="@{'https://image.tmdb.org/t/p/w500' + ${img.filePath}}" class="film-img" th:alt="${film.title + ' 관련 이미지'}">
                </div>
            </div>
        </div>

<!--        &lt;!&ndash; 영화 관련 비디오들 출력 &ndash;&gt;-->
<!--        <div th:if="${film_video}" style="margin-top: 40px;">-->
<!--            <h2>관련 비디오</h2>-->
<!--            <div>-->
<!--                <div th:each="video : ${film_video}">-->
<!--                    <h3 th:text="${video.videoName}">비디오 제목</h3>-->
<!--                    <iframe th:src="@{'https://www.youtube.com/embed/' + ${video.videoKey}}"-->
<!--                            width="560" height="315" frameborder="0" allowfullscreen-->
<!--                            style="margin: 10px;"></iframe>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->


    </div>
    <div class="container" th:unless="${film != null}">
        <h1>영화 정보를 찾을 수 없습니다.</h1>
    </div>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const ratingForm = document.getElementById('ratingForm');
            let ratingInputs = ratingForm.querySelectorAll('input[name="score"]');

            ratingInputs.forEach(input => {
                input.addEventListener('change', function() {
                    console.log('별점 변경: ', this.value);
                    ratingForm.submit();
                });
            });
            ratingInputs.forEach(input => {
                input.addEventListener('click', function() {
                    console.log('별점 변경: ', this.value);
                    ratingForm.submit();
                });
            });
        });
    </script>
</section>


</body>
</html>